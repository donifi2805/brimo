<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        :root {
            /* TEMA DARK MODE PREMIUM */
            --bg-body: #0f172a;       /* Dark Navy Background */
            --bg-card: #1e293b;       /* Card Background */
            --text-main: #f8fafc;     /* White Text */
            --text-muted: #94a3b8;    /* Gray Text */
            --primary-color: #3b82f6; /* Blue Primary */
            --primary-hover: #2563eb;
            --danger-color: #ef4444;  /* Red */
            --success-color: #10b981; /* Green */
            --warning-color: #f59e0b; /* Orange */
            --border-color: #334155;
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        /* Container Utama */
        .container {
            width: 100%;
            max-width: 500px; /* Ukuran Mobile Friendly */
            margin: 0 auto;
        }

        /* --- LOGIN SCREEN --- */
        #login-screen {
            background-color: var(--bg-card);
            padding: 40px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            margin-top: 50px;
        }

        /* --- DASHBOARD & GENERAL STYLES --- */
        #admin-panel { display: none; width: 100%; }
        .view-section { display: none; animation: fadeIn 0.3s ease; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        h2, h3 { color: var(--text-main); margin: 0 0 20px 0; font-weight: 600; }
        h2 { font-size: 1.5rem; text-align: center; }
        h3 { font-size: 1.1rem; border-left: 4px solid var(--primary-color); padding-left: 10px; }

        /* HEADER DENGAN TOMBOL KEMBALI/TAMBAH */
        .header-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: var(--bg-card);
            padding: 15px;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
        }
        .header-left { display: flex; align-items: center; gap: 10px; }
        .header-title { font-size: 1rem; font-weight: 600; margin: 0; }

        /* FORM STYLES */
        .form-group { margin-bottom: 15px; }
        label { display: block; color: var(--text-muted); font-size: 0.85rem; margin-bottom: 5px; }
        
        input, select {
            width: 100%;
            padding: 12px;
            background-color: var(--bg-body);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-main);
            font-size: 0.95rem;
            outline: none;
            transition: 0.2s;
        }
        input:focus { border-color: var(--primary-color); }

        /* BUTTONS */
        button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: 0.2s;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }
        button:active { transform: scale(0.98); }

        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:hover { background-color: var(--primary-hover); }
        
        .btn-danger { background-color: var(--danger-color); color: white; }
        .btn-warning { background-color: var(--warning-color); color: white; }
        .btn-success { background-color: var(--success-color); color: white; }
        
        .btn-secondary { background-color: #475569; color: white; width: auto; padding: 8px 12px; }
        .btn-icon { width: 35px; height: 35px; padding: 0; border-radius: 50%; }

        /* STATS CARDS */
        .stats-container {
            display: grid;
            gap: 15px;
            margin-bottom: 25px;
        }
        .stat-card {
            background-color: var(--bg-card);
            padding: 20px;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .stat-icon {
            width: 45px; height: 45px;
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem;
        }

        /* MENU GRID */
        .menu-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .menu-item {
            background-color: var(--bg-card);
            padding: 25px;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: 0.2s;
        }
        .menu-item:hover { background-color: #263344; border-color: var(--primary-color); }
        .menu-item i { font-size: 2rem; color: var(--primary-color); }
        .menu-item span { font-size: 0.9rem; font-weight: 500; }

        /* LIST ITEMS */
        .list-container { max-height: 500px; overflow-y: auto; }
        .list-item {
            background-color: var(--bg-card);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            margin-bottom: 10px;
        }
        .item-details { margin-bottom: 10px; }
        .item-title { font-weight: 600; font-size: 1rem; color: var(--text-main); }
        .item-sub { color: var(--text-muted); font-size: 0.85rem; }
        .item-amount { font-weight: 600; font-size: 1.1rem; margin-top: 5px; display: block; }
        
        .item-actions { display: flex; gap: 8px; }
        .item-actions button { padding: 8px; font-size: 0.8rem; }

        /* MODAL MENGAMBANG */
        .modal-overlay {
            display: none;
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(3px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-content {
            background: var(--bg-card);
            padding: 25px;
            border-radius: 16px;
            width: 100%;
            max-width: 400px;
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* Utilities */
        .text-green { color: var(--success-color); }
        .text-red { color: var(--danger-color); }
    </style>
</head>
<body>

    <div class="container">
        
        <div id="login-screen">
            <h2 style="border-bottom: 2px solid var(--primary-color); padding-bottom:10px;">Admin Login</h2>
            <form id="admin-login-form">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="admin-username" value="admin" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="admin-password" value="admin" required>
                </div>
                <button type="submit" id="admin-login-btn" class="btn-primary">
                    <i class="fas fa-sign-in-alt"></i> Masuk
                </button>
            </form>
        </div>

        <div id="admin-panel">
            
            <div id="dashboard-view" class="view-section">
                <div class="header-nav">
                    <span class="header-title">Dashboard</span>
                    <button class="btn-danger" onclick="location.reload()" style="width: auto; padding: 5px 10px; font-size: 0.8rem;">
                        <i class="fas fa-power-off"></i>
                    </button>
                </div>

                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(59, 130, 246, 0.2); color: #3b82f6;">
                            <i class="fas fa-users"></i>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; font-weight: 600;" id="stat-total-users">0</div>
                            <div style="color: var(--text-muted); font-size: 0.8rem;">Total User</div>
                        </div>
                    </div>
                </div>

                <div class="menu-grid">
                    <div class="menu-item" onclick="navToUserManagement()">
                        <i class="fas fa-user-cog"></i>
                        <span>Manajemen User</span>
                    </div>
                    <div class="menu-item" onclick="navToTxSelect()">
                        <i class="fas fa-exchange-alt"></i>
                        <span>Manajemen Transaksi</span>
                    </div>
                </div>
            </div>

            <div id="user-management-view" class="view-section">
                <div class="header-nav">
                    <div class="header-left">
                        <button onclick="showDashboard()" class="btn-secondary btn-icon"><i class="fas fa-arrow-left"></i></button>
                        <span class="header-title">User</span>
                    </div>
                    <button onclick="openUserModal()" class="btn-primary" style="width: auto; padding: 8px 12px;">
                        <i class="fas fa-plus"></i> Baru
                    </button>
                </div>

                <div class="form-group">
                    <input type="text" id="search-user-crud" placeholder="ðŸ” Cari user..." onkeyup="filterUsers('user-list-crud', this.value)">
                </div>

                <div id="user-list-crud" class="list-container"></div>
            </div>

            <div id="tx-select-view" class="view-section">
                <div class="header-nav">
                    <div class="header-left">
                        <button onclick="showDashboard()" class="btn-secondary btn-icon"><i class="fas fa-arrow-left"></i></button>
                        <span class="header-title">Pilih User</span>
                    </div>
                </div>

                <div class="form-group">
                    <input type="text" id="search-user-tx" placeholder="ðŸ” Cari user untuk dikelola..." onkeyup="filterUsers('user-list-tx', this.value)">
                </div>

                <div id="user-list-tx" class="list-container"></div>
            </div>

            <div id="tx-management-view" class="view-section">
                <div class="header-nav">
                    <div class="header-left">
                        <button onclick="navToTxSelect()" class="btn-secondary btn-icon"><i class="fas fa-arrow-left"></i></button>
                        <div style="display:flex; flex-direction:column;">
                            <span class="header-title">Transaksi</span>
                            <span id="tx-username-display" style="font-size:0.75rem; color:var(--primary-color);">User</span>
                        </div>
                    </div>
                </div>

                <form id="tx-form" style="background:var(--bg-card); padding:15px; border-radius:10px; border:1px solid var(--border-color); margin-bottom:20px;">
                    <h4 style="margin-top:0; margin-bottom:15px; font-size:0.9rem; color:var(--text-muted);">Tambah/Edit Transaksi</h4>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                        <input type="date" id="tx-date" required>
                        <input type="time" id="tx-time" required>
                    </div>
                    <div style="margin-top:10px;">
                        <input type="text" id="tx-desc" placeholder="Deskripsi (cth: Beli Token)" required>
                    </div>
                                        <div style="margin-top:10px; display:grid; grid-template-columns: 1fr 0.8fr 1fr; gap:10px;">
                        <input type="text" id="tx-via" placeholder="Via (cth: BRImo)" required>
                        <select id="tx-type" style="background-color: var(--bg-body); border: 1px solid var(--border-color); color: var(--text-main); border-radius:8px; padding: 0 10px;">
                            <option value="income">Pemasukan (+)</option>
                            <option value="expense">Pengeluaran (-)</option>
                        </select>
                        <input type="number" id="tx-amount-number" placeholder="Nominal (Angka)" required>
                    </div>
                    <div style="display:flex; gap:10px; margin-top:15px;">
                        <button type="submit" id="add-tx-btn" class="btn-primary">Simpan</button>
                        <button type="button" id="cancel-edit-tx-btn" class="btn-secondary hidden" onclick="resetTxForm()">Batal</button>
                    </div>
                </form>

                <div id="transaction-list-container" class="list-container"></div>
            </div>

        </div> </div> <div id="user-form-modal" class="modal-overlay">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h3 style="margin:0; border:none; padding:0;">User Form</h3>
                <button onclick="closeUserModal()" class="btn-secondary btn-icon"><i class="fas fa-times"></i></button>
            </div>
            
            <form id="create-user-form">
                <div class="form-group"><input type="text" id="login-username" placeholder="Username (cth: donitata)" required></div>
                <div class="form-group"><input type="text" id="login-password" placeholder="Password" required></div>
                <div class="form-group"><input type="text" id="rekening-number" placeholder="No. Rekening" required></div>
                <div class="form-group"><input type="number" id="saldo-awal" placeholder="Saldo Awal (Angka)" required></div>
                
                <button type="submit" id="create-user-btn" class="btn-primary">Simpan Data</button>
            </form>
        </div>
    </div>

    <div id="confirmation-modal" class="modal-overlay">
        <div class="modal-content" style="text-align: center;">
            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--warning-color); margin-bottom: 15px;"></i>
            <h3 style="border:none; padding:0; text-align: center;">Konfirmasi</h3>
            <p id="modal-message" style="color: var(--text-muted); margin-bottom: 25px;">Yakin ingin melakukan ini?</p>
            <div style="display: flex; gap: 10px;">
                <button id="btn-modal-cancel" class="btn-secondary">Batal</button>
                <button id="btn-modal-confirm" class="btn-danger">Ya, Lanjutkan</button>
            </div>
        </div>
    </div>

    <script>
        // --- KONFIGURASI ---
        const ADMIN_USERNAME = "admin";
        const ADMIN_PASSWORD = "admin";
        
        const firebaseConfig = {
          apiKey: "AIzaSyD2bI8R7u6KZW3gB_Pb0TVmDHkxG3dqu9A",
          authDomain: "brimoku-e49d0.firebaseapp.com",
          projectId: "brimoku-e49d0",
          storageBucket: "brimoku-e49d0.firebasestorage.app",
          messagingSenderId: "1093618052793",
          appId: "1:1093618052793:web:d2a804ff78e2f4156bf568"
        };
        const appId = firebaseConfig.projectId;

        // Vars
        let db, appUsersCollectionRef;
        let selectedUserId = null, editingUserId = null, editingTxId = null;
        let unsubscribeList = null, unsubscribeTxListener = null;

        // DOM Elements
        const views = document.querySelectorAll('.view-section');
        const loginScreen = document.getElementById('login-screen');
        const adminPanel = document.getElementById('admin-panel');
        
        // --- 1. INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('admin-login-form').addEventListener('submit', handleLogin);
            document.getElementById('create-user-form').addEventListener('submit', handleUserSubmit);
            document.getElementById('tx-form').addEventListener('submit', handleTxSubmit);
            
            // Modal Logic
            const confirmModal = document.getElementById('confirmation-modal');
            let confirmAction = null;
            
            window.showConfirmation = (msg, action) => {
                document.getElementById('modal-message').textContent = msg;
                confirmAction = action;
                confirmModal.style.display = 'flex';
            };
            
            document.getElementById('btn-modal-cancel').onclick = () => confirmModal.style.display = 'none';
            document.getElementById('btn-modal-confirm').onclick = async () => {
                if(confirmAction) await confirmAction();
                confirmModal.style.display = 'none';
            };
        });

        async function handleLogin(e) {
            e.preventDefault();
            const u = document.getElementById('admin-username').value;
            const p = document.getElementById('admin-password').value;
            const btn = document.getElementById('admin-login-btn');

            if(u === ADMIN_USERNAME && p === ADMIN_PASSWORD) {
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
                try {
                    firebase.initializeApp(firebaseConfig);
                    const auth = firebase.auth();
                    db = firebase.firestore();
                    await auth.signInAnonymously();
                    
                    appUsersCollectionRef = db.collection("artifacts").doc(appId).collection("app_users");
                    
                    loginScreen.style.display = 'none';
                    adminPanel.style.display = 'block';
                    showDashboard();
                } catch(err) {
                    alert("Koneksi Firebase Gagal: " + err.message);
                    btn.innerHTML = 'Coba Lagi';
                }
            } else {
                alert("Username/Password Salah!");
            }
        }

        // --- 2. NAVIGATION ---
        function switchView(viewId) {
            views.forEach(v => v.style.display = 'none');
            document.getElementById(viewId).style.display = 'block';
        }

        window.showDashboard = () => {
            switchView('dashboard-view');
            // Update stats sekilas (ambil snapshot once)
            if(appUsersCollectionRef) {
                appUsersCollectionRef.get().then(snap => {
                    document.getElementById('stat-total-users').textContent = snap.size;
                });
            }
        };

        window.navToUserManagement = () => {
            switchView('user-management-view');
            listenUsers('user-list-crud', 'crud');
        };

        window.navToTxSelect = () => {
            switchView('tx-select-view');
            listenUsers('user-list-tx', 'tx');
        };

        // --- 3. USER MANAGEMENT LOGIC ---
        function listenUsers(containerId, mode) {
            const container = document.getElementById(containerId);
            if(unsubscribeList) unsubscribeList();

            unsubscribeList = appUsersCollectionRef.orderBy("login_username").onSnapshot(snap => {
                if(snap.empty) {
                    container.innerHTML = '<p style="text-align:center;color:#888;padding:20px;">Belum ada user.</p>';
                    return;
                }
                container.innerHTML = '';
                snap.forEach(doc => {
                    const d = doc.data();
                    const el = document.createElement('div');
                    el.className = 'list-item';
                    
                    let btns = '';
                    if(mode === 'crud') {
                        btns = `
                            <button class="btn-warning" onclick="editUser('${doc.id}')"><i class="fas fa-edit"></i></button>
                            <button class="btn-danger" onclick="deleteUser('${doc.id}')"><i class="fas fa-trash"></i></button>
                        `;
                    } else {
                        btns = `<button class="btn-primary" onclick="manageTx('${doc.id}', '${d.login_username}')">Kelola Transaksi</button>`;
                    }

                    el.innerHTML = `
                        <div class="item-details">
                            <div class="item-title">${d.login_username}</div>
                            <div class="item-sub">${d.rekeningNumber}</div>
                        </div>
                        <div class="item-actions">${btns}</div>
                    `;
                    container.appendChild(el);
                });
            });
        }

        window.filterUsers = (id, term) => {
            const items = document.getElementById(id).getElementsByClassName('list-item');
            Array.from(items).forEach(item => {
                const txt = item.innerText.toLowerCase();
                item.style.display = txt.includes(term.toLowerCase()) ? 'block' : 'none';
            });
        };

        // Modal User Form
        const userModal = document.getElementById('user-form-modal');
        window.openUserModal = () => {
            document.getElementById('create-user-form').reset();
            editingUserId = null;
            document.getElementById('create-user-btn').textContent = 'Simpan User';
            userModal.style.display = 'flex';
        };
        window.closeUserModal = () => userModal.style.display = 'none';

        async function handleUserSubmit(e) {
            e.preventDefault();
            const btn = document.getElementById('create-user-btn');
            btn.disabled = true; btn.textContent = 'Menyimpan...';

            const data = {
                login_username: document.getElementById('login-username').value,
                login_password: document.getElementById('login-password').value,
                rekeningNumber: document.getElementById('rekening-number').value,
                saldo_awal: parseInt(document.getElementById('saldo-awal').value) || 0,
                profile_username: document.getElementById('login-username').value
            };

            try {
                if(editingUserId) {
                    await appUsersCollectionRef.doc(editingUserId).update(data);
                } else {
                    await appUsersCollectionRef.add(data);
                }
                closeUserModal();
            } catch(err) {
                alert("Error: " + err.message);
            }
            btn.disabled = false;
        }

        window.editUser = async (id) => {
            editingUserId = id;
            const doc = await appUsersCollectionRef.doc(id).get();
            const d = doc.data();
            document.getElementById('login-username').value = d.login_username;
            document.getElementById('login-password').value = d.login_password;
            document.getElementById('rekening-number').value = d.rekeningNumber;
            document.getElementById('saldo-awal').value = d.saldo_awal;
            
            document.getElementById('create-user-btn').textContent = 'Update User';
            userModal.style.display = 'flex';
        };

        window.deleteUser = (id) => {
            showConfirmation("Hapus user ini? Data transaksi juga akan hilang.", async () => {
                await appUsersCollectionRef.doc(id).delete();
            });
        };

        // --- 4. TRANSACTION MANAGEMENT ---
        window.manageTx = (userId, username) => {
            selectedUserId = userId;
            document.getElementById('tx-username-display').textContent = username;
            switchView('tx-management-view');
            resetTxForm();
            listenTx(userId);
        };

        function listenTx(userId) {
            const container = document.getElementById('transaction-list-container');
            if(unsubscribeTxListener) unsubscribeTxListener();
            
            unsubscribeTxListener = appUsersCollectionRef.doc(userId).collection('transactions')
                .orderBy('timestamp', 'desc')
                .onSnapshot(snap => {
                    if(snap.empty) {
                        container.innerHTML = '<p style="text-align:center;color:#888;padding:20px;">Belum ada transaksi.</p>';
                        return;
                    }
                    container.innerHTML = '';
                    snap.forEach(doc => {
                        const t = doc.data();
                        const color = t.amount.includes('-') ? 'var(--danger-color)' : 'var(--success-color)';
                        
                        const el = document.createElement('div');
                        el.className = 'list-item';
                        el.innerHTML = `
                            <div class="item-details">
                                <div class="item-title">${t.desc}</div>
                                <span class="item-amount" style="color:${color}">${t.amount}</span>
                                <div class="item-sub">${t.date} â€¢ ${t.time}</div>
                            </div>
                            <div class="item-actions">
                                <button class="btn-warning" onclick="editTx('${doc.id}')"><i class="fas fa-edit"></i></button>
                                <button class="btn-danger" onclick="deleteTx('${doc.id}')"><i class="fas fa-trash"></i></button>
                            </div>
                        `;
                        container.appendChild(el);
                    });
                });
        }

                async function handleTxSubmit(e) {
            e.preventDefault();
            if(!selectedUserId) return;
            
            // Ambil Data
            const dateIn = document.getElementById('tx-date').value;
            const timeIn = document.getElementById('tx-time').value;
            const type = document.getElementById('tx-type').value;
            let num = parseInt(document.getElementById('tx-amount-number').value) || 0;
            
            // LOGIKA BARU: Jika Pengeluaran, jadikan negatif
            if (type === 'expense') {
                num = Math.abs(num) * -1;
            } else {
                num = Math.abs(num);
            }
            
            // Format Date Text (ex: 20 Aug 2025)
            const dObj = new Date(dateIn);
            const months = ["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Ags","Sep","Okt","Nov","Des"];
            const dateTxt = `${dObj.getDate()} ${months[dObj.getMonth()]} ${dObj.getFullYear()}`;
            
            // Format Rupiah
            const rp = (num < 0 ? "- Rp" : "+ Rp") + Math.abs(num).toLocaleString('id-ID') + ",00";

            const data = {
                date: dateTxt,
                time: timeIn + " WIB",
                desc: document.getElementById('tx-desc').value,
                via: document.getElementById('tx-via').value,
                amount: rp,
                amount_number: num,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                const ref = appUsersCollectionRef.doc(selectedUserId).collection('transactions');
                if(editingTxId) {
                    delete data.timestamp; // Jangan update timestamp pembuatan
                    await ref.doc(editingTxId).update(data);
                } else {
                    await ref.add(data);
                }
                resetTxForm();
            } catch(err) {
                alert("Gagal simpan transaksi: " + err.message);
            }
        }

                window.editTx = async (txId) => {
            editingTxId = txId;
            const doc = await appUsersCollectionRef.doc(selectedUserId).collection('transactions').doc(txId).get();
            const d = doc.data();

            document.getElementById('tx-desc').value = d.desc;
            document.getElementById('tx-via').value = d.via;
            
            // LOGIKA BARU: Set Selector berdasarkan positif/negatif
            const rawNum = d.amount_number;
            document.getElementById('tx-amount-number').value = Math.abs(rawNum); // Tampilkan angka positif saja di input
            document.getElementById('tx-type').value = rawNum < 0 ? 'expense' : 'income';
            
            // Tombol jadi Simpan Perubahan
            document.getElementById('add-tx-btn').textContent = 'Update';
            document.getElementById('cancel-edit-tx-btn').classList.remove('hidden');
            document.querySelector('#tx-form h4').textContent = 'Edit Transaksi';
            window.scrollTo(0,0);
        };

        window.deleteTx = (txId) => {
            showConfirmation("Hapus transaksi ini?", async () => {
                await appUsersCollectionRef.doc(selectedUserId).collection('transactions').doc(txId).delete();
            });
        };

        window.resetTxForm = () => {
            editingTxId = null;
            document.getElementById('tx-form').reset();
            document.getElementById('add-tx-btn').textContent = 'Simpan';
            document.getElementById('cancel-edit-tx-btn').classList.add('hidden');
            document.querySelector('#tx-form h4').textContent = 'Tambah Transaksi Baru';
        };

    </script>
</body>
</html>